import{R as D,T as u,j as d,a as t,b,D as S,C,S as f,I as k,c as R,B as p,d as B,e as j,f as K,g as A,h as G,i as x,k as J,l as $,L as O,m as L,r as U,H as Y,N as I,n as Q,o as X,p as Z,q as _,s as E,t as ee}from"./vendor.e254195a.js";const te=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function l(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerpolicy&&(n.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?n.credentials="include":i.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=l(i);fetch(i.href,n)}};te();const{Column:g}=x,v="/monitor";class ae extends D.Component{init(){const e=this;let l=[],r=[],i=[];fetch(v+"/appId/list").then(n=>{n.json().then(a=>{for(var o=0;o<a.data.length;o++)l.push({value:a.data[o],label:a.data[o],type:"appId"});e.setState({appIdList:l,countData:[{key:"Total hit logs",value:0},{key:"Number of apps",value:l.length},{key:"Number of environments",value:i.length},{key:"Number of data centers",value:r.length}]})})}).catch(n=>{u.error("Request fail")}),fetch(v+"/idc/list").then(n=>{n.json().then(a=>{for(var o=0;o<a.data.length;o++)r.push({value:a.data[o],label:a.data[o],type:"idc"});e.setState({idcList:r,countData:[{key:"Total hit logs",value:0},{key:"Number of apps",value:l.length},{key:"Number of environments",value:i.length},{key:"Number of data centers",value:r.length}]})})}).catch(n=>{u.error("Request fail")}),fetch(v+"/env/list").then(n=>{n.json().then(a=>{for(var o=0;o<a.data.length;o++)i.push({value:a.data[o],label:a.data[o],type:"env"});e.setState({envList:i,countData:[{key:"Total hit logs",value:0},{key:"Number of apps",value:l.length},{key:"Number of environments",value:i.length},{key:"Number of data centers",value:r.length}]})})}).catch(n=>{u.error("Request fail")}),e.setState({logTimeStart:new Date(new Date().getTime()-18e5),logTimeEnd:new Date(new Date().getTime()),levelList:[{value:0,label:"ALL",type:"level"},{value:1,label:"DEBUG",type:"level"},{value:2,label:"INFO",type:"level"},{value:3,label:"WARN",type:"level"},{value:4,label:"ERROR",type:"level"},{value:5,label:"FATAL",type:"level"}]})}onChange(e){const l=this;let r=[],i=[],n=[],a=[];e.type=="env"&&this.setState({env:e.value}),e.type=="host"&&this.setState({host:e.value}),e.type=="subCategory"&&this.setState({subCategory:e.value}),e.type=="level"&&this.setState({level:e.value}),e.type=="appId"&&(this.setState({appId:e.value}),fetch(v+"/module/list?appId="+e.value).then(o=>{o.json().then(s=>{for(var h=0;h<s.data.length;h++)r.push({value:s.data[h],label:s.data[h],type:"module"});l.setState({moduleList:r})})}).catch(o=>{u.error("Request fail")})),e.type=="module"&&(this.setState({module:e.value}),fetch(v+"/category/list?appId="+l.state.appId+"&module="+e.value).then(o=>{o.json().then(s=>{for(var h=0;h<s.data.length;h++)i.push({value:s.data[h],label:s.data[h],type:"category"});l.setState({categoryList:i})})}).catch(o=>{u.error("Request fail")})),e.type=="category"&&(this.setState({category:e.value}),fetch(v+"/subCategory/list?appId="+l.state.appId+"&module="+l.state.module+"&category="+e.value).then(o=>{o.json().then(s=>{for(var h=0;h<s.data.length;h++)n.push({value:s.data[h],label:s.data[h],type:"subCategory"});l.setState({subCategoryList:n})})}).catch(o=>{u.error("Request fail")})),e.type=="idc"&&(this.setState({idc:e.value}),fetch(v+"/host/list?idc="+e.value).then(o=>{o.json().then(s=>{for(var h=0;h<s.data.length;h++)a.push({value:s.data[h],label:s.data[h],type:"host"});l.setState({hostList:a})})}).catch(o=>{u.error("Request fail")}))}tagChange(e,l){this.setState({tag:e})}traceIdChange(e,l){this.setState({traceId:e})}filter1Change(e,l){this.setState({filter1:e})}filter2Change(e,l){this.setState({filter2:e})}keywordChange(e,l){this.setState({keyword:e})}logTimeStartChange(e,l){this.setState({logTimeStart:e})}logTimeEndChange(e,l){this.setState({logTimeEnd:e})}pageIndexChange(e,l){this.setState({pageIndex:e})}pageSizeChange(e,l){this.setState({pageSize:e})}search(){this.setState({searchLoading:!0});let e=this,l={idc:e.state.idc,host:e.state.host,env:e.state.env,appId:e.state.appId,module:e.state.module,category:e.state.category,subCategory:e.state.subCategory,tag:e.state.tag,traceId:e.state.traceId,filter1:e.state.filter1,filter2:e.state.filter2,level:e.state.level,keyword:e.state.keyword,logTimeStart:e.state.logTimeStart.getTime(),logTimeEnd:e.state.logTimeEnd.getTime(),pageIndex:e.state.pageIndex,pageSize:e.state.pageSize},r=Object.keys(l).map(i=>i+"="+l[i]).join("&");fetch(v+"/log/list?"+r,{method:"get"}).then(i=>{let n=[];i.json().then(a=>{let o={};for(var s=0;s<a.data.list.length;s++){let c=new Date(a.data.list[s].logTime);var h=c.getFullYear()+"-",z=(c.getMonth()+1<10?"0"+(c.getMonth()+1):c.getMonth()+1)+"-",M=(c.getDate()<10?"0"+c.getDate():c.getDate())+" ",q=(c.getHours()<10?"0"+c.getHours():c.getHours())+":",P=(c.getMinutes()<10?"0"+c.getMinutes():c.getMinutes())+":",F=c.getSeconds()<10?"0"+c.getSeconds():c.getSeconds();a.data.list[s].logTime=h+z+M+q+P+F;let H=JSON.parse(JSON.stringify(a.data.list[s]));n.push(t($,{name:"log",style:{fontWeight:600,fontSize:"16px"},src:H,displayDataTypes:!1,theme:"monokai"}));let T="",w="";a.data.list[s].title.length>=100&&(T="..."),a.data.list[s].content.length>=300&&(w="..."),a.data.list[s].message=d("div",{children:[t(b,{color:"blue",type:"ghost",children:"title"}),t("div",{style:{fontWeight:600,margin:"5px"},children:a.data.list[s].title.slice(0,100)+T}),t(b,{style:{marginTop:"5px"},color:"teal",type:"ghost",children:"content"}),t("div",{style:{margin:"5px"},children:a.data.list[s].content.slice(0,300)+w})]});let m="";switch(a.data.list[s].level){case 1:m="blue",a.data.list[s].level=t(b,{color:m,type:"solid",children:"DEBUG"});break;case 2:m="green",a.data.list[s].level=t(b,{color:m,type:"solid",children:"INFO"});break;case 3:m="orange",a.data.list[s].level=t(b,{color:m,type:"solid",children:"WARN"});break;case 4:m="red",a.data.list[s].level=t(b,{color:m,type:"solid",children:"ERROR"});break;case 5:m="grey",a.data.list[s].level=t(b,{color:m,type:"solid",children:"FATAL"});break}o[s]=[{key:"level",value:a.data.list[s].level},{key:"id",value:a.data.list[s].id},{key:"traceId",value:a.data.list[s].traceId},{key:"title",value:a.data.list[s].title},{key:"content",value:a.data.list[s].content},{key:"remarks",value:a.data.list[s].remarks},{key:"tag",value:a.data.list[s].tag},{key:"filter1",value:a.data.list[s].filter1},{key:"filter2",value:a.data.list[s].filter2},{key:"module",value:a.data.list[s].module},{key:"category",value:a.data.list[s].category},{key:"subCategory",value:a.data.list[s].subCategory},{key:"file",value:a.data.list[s].file},{key:"position",value:a.data.list[s].position},{key:"idc",value:a.data.list[s].idc},{key:"host",value:a.data.list[s].host},{key:"appId",value:a.data.list[s].appId},{key:"env",value:a.data.list[s].env},{key:"logTime",value:a.data.list[s].logTime}]}let V=[{key:"Total number of hit logs",value:a.data.total},{key:"Number of apps",value:e.state.appIdList.length},{key:"Number of environments",value:e.state.envList.length},{key:"Number of data centers",value:e.state.idcList.length}];e.setState({searchLoading:!1,expandData:o,logList:a.data.list,jsonLogList:n,countData:V}),u.success("Search succeeded")})}).then(i=>{e.setState({searchLoading:!1})}).catch(i=>{u.error("Request fail"),e.setState({searchLoading:!1})})}expandRowRender(e,l){return t(S,{align:"left",data:this.state.expandData[l]})}setDateTime(e,l){this.setState({logTimeStart:new Date(new Date().getTime()-l),logTimeEnd:new Date(new Date().getTime())})}constructor(e){super(e);this.state={idc:"",host:"",env:"",appId:"",module:"",category:"",subCategory:"",tag:"",traceId:"",filter1:"",filter2:"",level:0,keyword:"",logTimeStart:0,logTimeEnd:0,pageIndex:0,pageSize:50,idcList:[],hostList:[],envList:[],appIdList:[],moduleList:[],categoryList:[],subCategoryList:[],levelList:[],logList:[],jsonLogList:[t("h2",{})],expandData:{},countData:[{key:"Total number of hit logs",value:0},{key:"Number of apps",value:0},{key:"Number of environments",value:0},{key:"Number of data centers",value:0}],searchLoading:!1},this.tagChange=this.tagChange.bind(this),this.traceIdChange=this.traceIdChange.bind(this),this.filter1Change=this.filter1Change.bind(this),this.filter2Change=this.filter2Change.bind(this),this.logTimeStartChange=this.logTimeStartChange.bind(this),this.logTimeEndChange=this.logTimeEndChange.bind(this),this.pageIndexChange=this.pageIndexChange.bind(this),this.pageSizeChange=this.pageSizeChange.bind(this),this.keywordChange=this.keywordChange.bind(this),this.setDateTime=this.setDateTime.bind(this)}componentDidMount(){localStorage.getItem("mode")==null&&(document.body.setAttribute("theme-mode","dark"),localStorage.setItem("mode","dark")),localStorage.getItem("mode")==="dark"?document.body.setAttribute("theme-mode","dark"):document.body.removeAttribute("theme-mode"),this.init()}render(){return d("div",{children:[d(C,{className:"site-home-card",children:[d("div",{className:"site-home",children:[t(f,{validateStatus:"error",className:"site-home-input",prefix:"AppId",onChangeWithObject:!0,optionList:this.state.appIdList,defaultValue:this.state.appIdList[0],onChange:this.onChange.bind(this)}),t("p",{style:{marginRight:"20px"}}),t(f,{showClear:!0,className:"site-home-input",prefix:"Module",onChangeWithObject:!0,optionList:this.state.moduleList,defaultValue:this.state.moduleList[0],onChange:this.onChange.bind(this)}),t(f,{showClear:!0,className:"site-home-input",prefix:"Category",onChangeWithObject:!0,optionList:this.state.categoryList,defaultValue:this.state.categoryList[0],onChange:this.onChange.bind(this)}),t(f,{showClear:!0,className:"site-home-input",prefix:"SubCategory",onChangeWithObject:!0,optionList:this.state.subCategoryList,defaultValue:this.state.subCategoryList[0],onChange:this.onChange.bind(this)}),t("p",{style:{marginRight:"20px"}}),t(f,{showClear:!0,className:"site-home-input",prefix:"IDC",onChangeWithObject:!0,optionList:this.state.idcList,defaultValue:this.state.idcList[0],onChange:this.onChange.bind(this)}),t(f,{showClear:!0,className:"site-home-input",prefix:"Host",onChangeWithObject:!0,optionList:this.state.hostList,defaultValue:this.state.hostList[0],onChange:this.onChange.bind(this)})]}),d("div",{className:"site-home",children:[t(k,{className:"site-home-input",prefix:"TraceId",showClear:!0,value:this.state.traceId,onChange:this.traceIdChange}),t(k,{className:"site-home-input",prefix:"Tag",showClear:!0,value:this.state.tag,onChange:this.tagChange}),t(k,{className:"site-home-input",prefix:"Filter1",showClear:!0,value:this.state.filter1,onChange:this.filter1Change}),t(k,{className:"site-home-input",prefix:"Filter2",showClear:!0,value:this.state.filter2,onChange:this.filter2Change})]}),d("div",{className:"site-home",children:[t(R,{className:"site-home-input",prefix:"StartTime",type:"dateTime",value:this.state.logTimeStart,onChange:this.logTimeStartChange}),t(R,{className:"site-home-input",prefix:"EndTime",type:"dateTime",value:this.state.logTimeEnd,onChange:this.logTimeEndChange}),t(p,{className:"site-home-input",onClick:e=>this.setDateTime(e,30*60*1e3),children:"30 minutes"}),t(p,{className:"site-home-input",onClick:e=>this.setDateTime(e,2*60*60*1e3),children:"2 hours"}),t(p,{className:"site-home-input",onClick:e=>this.setDateTime(e,6*60*60*1e3),children:"6 hours"}),t(p,{className:"site-home-input",onClick:e=>this.setDateTime(e,12*60*60*1e3),children:"12 hours"}),t(p,{className:"site-home-input",onClick:e=>this.setDateTime(e,24*60*60*1e3),children:"24 hours"}),t(p,{className:"site-home-input",onClick:e=>this.setDateTime(e,48*60*60*1e3),children:"48 hours"}),t(p,{className:"site-home-input",onClick:e=>this.setDateTime(e,72*60*60*1e3),children:"72 hours"})]}),d("div",{className:"site-home",children:[t(f,{showClear:!0,className:"site-home-input",prefix:"Env",onChangeWithObject:!0,optionList:this.state.envList,defaultValue:this.state.envList[0],onChange:this.onChange.bind(this)}),t(f,{className:"site-home-input",prefix:"Level",onChangeWithObject:!0,optionList:this.state.levelList,defaultValue:this.state.levelList[0],onChange:this.onChange.bind(this)}),t(k,{className:"site-home-input",prefix:t(B,{}),showClear:!0,value:this.state.keyword,onChange:this.keywordChange}),t(j,{className:"site-home-input",defaultValue:0,min:0,onNumberChange:!0,value:this.state.pageIndex,onChange:this.pageIndexChange}),t(j,{className:"site-home-input",defaultValue:50,min:0,onNumberChange:!0,value:this.state.pageSize,onChange:this.pageSizeChange}),t(p,{className:"site-home-input",loading:this.state.searchLoading,onClick:this.search.bind(this),children:"Search"})]})]}),t(C,{className:"site-home-card",children:t(S,{data:this.state.countData,row:!0,size:"medium"})}),t(C,{className:"site-home-card",children:d(K,{type:"button",children:[t(A,{tab:d("span",{children:[t(G,{}),"Table"]}),itemKey:"1",children:d(x,{className:"site-home-table",loading:this.state.searchLoading,expandedRowRender:this.expandRowRender.bind(this),hideExpandedColumn:!1,rowKey:"id",dataSource:this.state.logList,pagination:!1,bordered:!0,size:"medium",children:[t(g,{title:"level",dataIndex:"level",width:"80px"},"level"),t(g,{title:"logTime",dataIndex:"logTime",width:"200px"},"logTime"),t(g,{title:"message",dataIndex:"message",width:"800px"},"message"),t(g,{title:"module",dataIndex:"module",width:"180px"},"module"),t(g,{title:"category",dataIndex:"category",width:"180px"},"category"),t(g,{title:"subCategory",dataIndex:"subCategory",width:"180px"},"subCategory"),t(g,{title:"file",dataIndex:"file",width:"180px"},"file"),t(g,{title:"tag",dataIndex:"tag",width:"180px"},"tag"),t(g,{title:"env",dataIndex:"env",width:"180px"},"env"),t(g,{title:"host",dataIndex:"host",width:"180px"},"host"),t(g,{title:"idc",dataIndex:"idc",width:"180px"},"idc")]})}),t(A,{tab:d("span",{children:[t(J,{}),"Json"]}),itemKey:"2",children:this.state.jsonLogList})]})})]})}}const{Column:N}=x,W="/monitor";class se extends D.Component{init(){const e=this;let l=[],r=[];fetch(W+"/worker/node/list").then(i=>{i.json().then(n=>{l=n.data;let a=[{key:"Number of router nodes",value:r.length},{key:"Number of worker nodes",value:l.length}];e.setState({workerList:l,countData:a})})}).catch(i=>{u.error("Request fail")}),fetch(W+"/router/node/list").then(i=>{i.json().then(n=>{r=n.data;let a=[{key:"Number of router nodes",value:r.length},{key:"Number of worker nodes",value:l.length}];e.setState({countData:a,routerList:r})})}).catch(i=>{u.error("Request fail")})}constructor(e){super(e);this.state={workerList:[],routerList:[],countData:[{key:"Number of router nodes",value:0},{key:"Number of worker nodes",value:0}]}}componentDidMount(){localStorage.getItem("mode")==null&&(document.body.setAttribute("theme-mode","dark"),localStorage.setItem("mode","dark")),localStorage.getItem("mode")==="dark"?document.body.setAttribute("theme-mode","dark"):document.body.removeAttribute("theme-mode"),this.init()}render(){return d("div",{children:[t(C,{className:"site-home-card",children:t(S,{data:this.state.countData,row:!0,size:"medium"})}),t(C,{title:"Router nodes",className:"site-home-card",children:t(O,{size:"large",bordered:!0,dataSource:this.state.routerList,renderItem:e=>t(O.Item,{children:e})})}),t(C,{title:"Worker nodes",className:"site-home-card",children:d(x,{className:"site-home-table",dataSource:this.state.workerList,pagination:!1,bordered:!0,size:"medium",children:[t(N,{title:"Address",dataIndex:"address"},"address"),t(N,{title:"UDP Port",dataIndex:"udpPort"},"udpPort"),t(N,{title:"HTTP Port",dataIndex:"httpPort"},"httpPort")]})})]})}}const ie=()=>{const y=document.body;y.hasAttribute("theme-mode")?(y.removeAttribute("theme-mode"),localStorage.setItem("mode","light")):(y.setAttribute("theme-mode","dark"),localStorage.setItem("mode","dark"))};function le(){const{Header:y,Sider:e,Content:l,Footer:r}=L,[i,n]=U.exports.useState(!0),a=o=>{n(o)};return t(L,{className:"components-layout-demo",style:{height:"100%"},children:d(Y,{children:[t(y,{children:t("div",{children:d(I,{mode:"horizontal",children:[t("span",{style:{color:"var(--semi-color-text-2)"},children:t("span",{style:{marginRight:"24px",color:"var(--semi-color-text-0)",fontWeight:"600"},children:"Alisa Log"})}),t(I.Footer,{children:t(p,{type:"tertiary",theme:"borderless",onClick:ie,children:t(Q,{})})})]})})}),d(L,{children:[d(L,{children:[t(e,{children:t(I,{defaultOpenKeys:["1"],style:{height:"100%",top:"0px",bottom:"0px"},items:[{itemKey:"1",text:"Log",icon:t(X,{}),link:"/"},{itemKey:"2",text:"Node",icon:t(Z,{}),link:"/#/nodeList"}],onSelect:o=>console.log(o),footer:{collapseButton:!0},isCollapsed:i,onCollapseChange:a})}),t(l,{style:{color:"var(--semi-color-text-0)",backgroundColor:"var( --semi-color-bg-0)"},children:d(_,{children:[t(E,{exact:!0,path:"/",children:t(ae,{})}),t(E,{path:"/nodeList",children:t(se,{})})]})})]}),d(r,{style:{display:"flex",justifyContent:"space-between",padding:"20px",color:"var(--semi-color-text-2)",backgroundColor:"rgba(var(--semi-grey-0), 1)",height:"6vh"},children:[t("span",{style:{display:"flex",alignItems:"flex-start"},children:t("span",{style:{fontWeight:600},children:"dpwgc / alisalog"})}),d("span",{children:[t("a",{href:"https://github.com/dpwgc/alisalog",style:{marginRight:"12px",color:"rgba(var(--semi-blue-5), 1)",fontWeight:500},children:"Github"}),t("a",{href:"https://gitee.com/dpwgc/alisalog",style:{color:"rgba(var(--semi-blue-5), 1)",fontWeight:500},children:"Gitee"})]})]})]})]})})}ee.render(t(le,{}),document.getElementById("root"));
